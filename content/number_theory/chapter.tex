\chapter{Number Theory}

\kactlimport{exgcd.cpp}{Extended GCD}
\kactlimport{crt.cpp}{CRT}
\kactlimport{miller_rabin.cpp}{Miller-Rabin}
\kactlimport{pollard_rho.cpp}{Pollard-Rho}

\section{Möbius function}
$$\mu(n) = 
	\begin{cases}
		0, n \text{ is not square free}\\	
		1, n \text{ has even number of prime factors}\\
		-1, n \text{ has odd number of prime factors}\\
	\end{cases}
$$
$$\sum_{d | n} \mu(d) = \text{int}(n = 1)$$
Möbius inversion:
$$g(n) = \sum_{d | n} f(d) \iff f(n) = \sum_{d | n} \mu(d) g(n / d) = \sum_{d | n} \mu(n / d) g(d)$$

\section{Sums of powers}
$$\sum_{s = 1}^{n} s^k = \sum_{s = 1}^{k}s! S(k, s) C_{n + 1}^{s + 1}$$
$\sum_{s = 1}^{n} s^1 = 1\frac{(n + 1)n}{2!}$

$\sum_{s = 1}^{n} s^2 = 1\frac{(n + 1)n}{2!} + 2\frac{(n + 1)n(n-1)}{3!} = \frac{n(n+1)(2n+1)}{6}$
$\sum_{s = 1}^{n} s^3 = 1\frac{(n + 1)n}{2!} + 6\frac{(n + 1)n(n-1)}{3!} + 6\frac{(n + 1)n(n-1)(n-2)}{4!} = \frac{(n+1)^2n^2}{4}$

\section{Floor sum}

$$f(a, b, c, n) = \sum_{x=0}^n \left\lfloor\frac{ax + b}{c}\right\rfloor$$

Let $m = \left\lfloor\frac{an + b}{c}\right\rfloor$. When $a < c$ and $b < c$, we have:

$$f(a, b, c, n) = mn - f\left(c, c - b - 1, a, m - 1\right)$$

Otherwise:

$$f(a, b, c, n) = \frac{n(n + 1)}{2} \left\lfloor\frac{a}{c}\right\rfloor + (n + 1) \left\lfloor\frac{b}{c}\right\rfloor + f(a \bmod c, b \bmod c, c, n) $$

\section{Square of floor sum}

$$g(a, b, c, n) = \sum_{x=0}^n x \left\lfloor\frac{ax + b}{c}\right\rfloor$$
$$h(a, b, c, n) = \sum_{x=0}^n {\left\lfloor\frac{ax + b}{c}\right\rfloor}^2$$

Let $m = \left\lfloor\frac{an + b}{c}\right\rfloor$. When $a < c$ and $b < c$, we have:
$$g(a, b, c, n) = \frac{mn(n + 1)}{2} - \frac{f(c, c - b - 1, a, m - 1)}{2} - \frac{h(c, c - b - 1, a, m - 1)}{2}$$
$$h(a, b, c, n) = mn(m + 1) - 2g(c, c - b - 1, a, m - 1) - 2f(c, c - b - 1, a, m - 1)$$$$- f(a, b, c, n)$$

Otherwise:
$$g(a, b, c, n) = \frac{n(n + 1)(2n + 1)}{6} \left\lfloor\frac{a}{c}\right\rfloor + \frac{n(n + 1)}{2} \left\lfloor\frac{b}{c}\right\rfloor + g(a \bmod c, b \bmod c, c, n)$$
$$h(a, b, c, n) = \frac{n(n + 1)(2n + 1)}{6} \left\lfloor\frac{a}{c}\right\rfloor^2 + (n + 1) \left\lfloor\frac{b}{c}\right\rfloor^2 + n(n + 1) \left\lfloor\frac{a}{c}\right\rfloor \left\lfloor\frac{b}{c}\right\rfloor +$$$$+ h(a \bmod c, b \bmod c, c, n) + 2 \left\lfloor\frac{b}{c}\right\rfloor f(a \bmod c, b \bmod c, c, n) +$$$$+ 2 \left\lfloor\frac{a}{c}\right\rfloor g(a \bmod c, b \bmod c, c, n)$$
